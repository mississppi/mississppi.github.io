---
title: "サブクエリの使い方：FROM句 vs WHERE句"
slug: "subquery"
order: 1
source: "sql"
---

SQLでサブクエリを書くとき、「FROMに書く派」「WHEREに書く派」で分かれることがあります。  
それぞれの使いどころや考え方を整理しておきましょう。

---

## ✅ FROM句 vs WHERE句：使い分けの比較表

| 観点             | FROM句サブクエリ                                       | WHERE句サブクエリ                                  |
|------------------|--------------------------------------------------------|-----------------------------------------------------|
| 主な用途         | 集計やデータ構造の再編成                                | 条件のフィルタリングや存在チェック                  |
| 返す結果         | テーブル（複数列・複数行）                              | 単一の値、またはブール判定（EXISTSなど）           |
| 読みやすさ       | 構造が見やすく、中間処理の明示に向く                     | ネストが深くなると読みにくいが短く書ける           |
| パフォーマンス   | CTEやJOINと併用でき、インデックス活用の余地がある         | 実行計画次第ではパフォーマンスに注意が必要         |
| よく使う例       | 仮想テーブルを作って再利用する                         | 平均値や存在チェックで単発使用                     |

---

## 📌 FROM句サブクエリ（テーブルとして扱いたいとき）

```sql
SELECT dept, avg_salary
FROM (
  SELECT department AS dept, AVG(salary) AS avg_salary
  FROM employees
  GROUP BY department
) AS dept_avg;
```

- 中間的な集計結果を構造化できる
- JOINやさらにフィルタを加えやすい
- 再利用したいデータ構造に便利

---

## 📌 WHERE句サブクエリ（値や条件に使いたいとき）

```sql
SELECT name
FROM employees
WHERE salary > (
  SELECT AVG(salary)
  FROM employees
);
```

- 単純な比較に強い
- EXISTS、IN、=、> などの条件に使う
- ネストが深くなると注意

---

## 📝 実務的な使い分けのヒント

- 中間処理が複雑 → **FROM句** を使って読みやすさ重視
- 単純な条件判定 → **WHERE句** を使って簡潔に
- ネストが深くなりすぎないように注意（特にWHERE句）
- **JOINよりもパフォーマンスに差が出ることもあるので、EXPLAINで確認するのも◎**

---

## 🔚 結論

どちらが「正解」ということではなく、**意図・構造・読みやすさ・パフォーマンス**を総合して判断するのがベストです。
