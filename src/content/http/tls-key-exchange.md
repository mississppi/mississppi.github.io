---
title: "TLSの鍵交換のしくみ"
slug: "tls-key-exchange"
tags: ["TLS", "暗号化", "HTTPS"]
---

# 🔐 TLSの鍵交換のしくみ（やさしく解説）

HTTPSでは、通信内容を守るために「共通鍵暗号」を使って通信します。  
ただしその共通鍵を**安全にやりとりする**のが課題でした。  
そこで使われるのが「**公開鍵暗号**」と「**プレマスターシークレット**」です。

---

## 🔑 共通鍵ってなに？

- 実際の通信では「共通鍵暗号方式（AESなど）」でデータを暗号化します。
- **送信者と受信者が同じ鍵を持っていないと通信できません**。

でも、「じゃあその共通鍵ってどうやって共有するの？」という問題が出てきます。

---

## 🧪 プレマスターシークレットとは？

- クライアント（ブラウザ）が**ランダムな値（乱数）を生成**します。
- これは **共通鍵を導き出すための「材料」**です。
- これを「プレマスターシークレット」と呼びます。

---

## 🔐 鍵交換の流れ（RSA方式の場合）

1. ブラウザがプレマスターシークレットを生成
2. それを**サーバーの公開鍵**で暗号化して送信
3. サーバーが**自分の秘密鍵**で復号
4. クライアントとサーバーが同じ「プレマスターシークレット」を持つ
5. 双方がこの値と他の情報（乱数など）をもとに「共通鍵（セッション鍵）」を生成
6. 以後の通信はこの共通鍵で**暗号化通信**

---

## 🎯 用語まとめ

| 用語 | 意味 |
|------|------|
| プレマスターシークレット | 共通鍵を作るための材料となる乱数（クライアント側で生成） |
| 公開鍵 | サーバーがみんなに公開している鍵（暗号化に使う） |
| 秘密鍵 | サーバーがこっそり持ってる鍵（復号に使う） |
| 共通鍵（セッション鍵） | 双方が同じ値を持つ暗号化用の鍵。これで通信を暗号化する |

---

## 🔒 なぜ安全なの？

- 共通鍵そのものを送らないので、盗まれる心配がない
- 公開鍵で暗号化してるので、盗聴者には中身がわからない
- 結果として、安全に暗号通信が始められる！

